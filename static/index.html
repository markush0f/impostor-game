<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Juego del Impostor ‚öΩ</title>
  <style>
    body { font-family: Arial, sans-serif; background: #2b5876; color: white; text-align: center; padding: 40px; }
    .card { background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; max-width: 400px; margin: auto; }
    input, button { margin: 10px; padding: 10px; border-radius: 8px; border: none; }
    .btn { cursor: pointer; font-weight: bold; }
    .btn-create { background: #00c853; color: white; }
    .btn-join { background: #2196f3; color: white; }
    .btn-start { background: #ff3d00; color: white; }
  </style>
</head>
<body>
  <h1>‚öΩ Juego del Impostor</h1>

  <div class="card" id="menu">
    <button class="btn btn-create" onclick="createGame()">Crear Partida</button>
    <button class="btn btn-join" onclick="showJoin()">Unirse a Partida</button>
  </div>

  <div class="card" id="join-section" style="display:none;">
    <label>C√≥digo de sala:</label><br>
    <input type="text" id="game" placeholder="Ejemplo: X7K9Q"><br>
    <label>Tu nombre:</label><br>
    <input type="text" id="name" placeholder="Ejemplo: Markus"><br>
    <button class="btn btn-join" onclick="connect()">Conectarse</button>
  </div>

  <h2 id="status"></h2>
  <h3 id="role"></h3>
  <button class="btn btn-start" onclick="startGame()" style="display:none;" id="startBtn">üöÄ Iniciar Partida</button>

  <script>
    let socket, gameId, playerName;

    async function createGame() {
      const res = await fetch("http://localhost:8000/create_game", { method: "POST" });
      const data = await res.json();
      gameId = data.game_id;
      document.getElementById("menu").innerHTML = `<h2>üéÆ Sala creada: ${gameId}</h2>
        <p>Comparte este c√≥digo con tus amigos.</p>
        <label>Tu nombre:</label><br>
        <input type="text" id="name" placeholder="Ejemplo: Markus"><br>
        <button class="btn btn-join" onclick="connect()">Conectarse</button>`;
      document.getElementById("startBtn").style.display = "inline-block";
    }

    function showJoin() {
      document.getElementById("menu").style.display = "none";
      document.getElementById("join-section").style.display = "block";
    }

    function connect() {
      playerName = document.getElementById("name").value.trim();
      if (!gameId) gameId = document.getElementById("game").value.trim();

      if (!gameId || !playerName) {
        alert("Introduce el c√≥digo de sala y tu nombre.");
        return;
      }

      socket = new WebSocket(`ws://localhost:8000/ws/${gameId}/${playerName}`);

      socket.onopen = () => {
        document.getElementById("status").innerText = `‚úÖ Conectado a la sala ${gameId} como ${playerName}`;
      };
      socket.onmessage = (event) => {
        document.getElementById("role").innerText = "üé≠ Tu rol: " + event.data;
      };
      socket.onclose = () => document.getElementById("status").innerText = "‚ùå Desconectado";
    }

    async function startGame() {
      const res = await fetch(`http://localhost:8000/start_game/${gameId}`, { method: "POST" });
      const data = await res.json();
      alert(data.message);
    }
  </script>
</body>
</html>
